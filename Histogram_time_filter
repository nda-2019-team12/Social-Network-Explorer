library(data.table)     # Run once per session
library(ggplot2)        # Run once per session
library(stringr)
library(igraph)

# Load previously saved data.
load("reddit_complete.RData")

# add columns of "date" and "time" to the data table, splited from TIMESTAMP
dt.reddit.subset <- 
  dt.reddit.both[, date := str_split_fixed(dt.reddit.both$TIMESTAMP, " ", 2)[,1]]
dt.reddit.subset.time <- 
  dt.reddit.both[, time := str_split_fixed(dt.reddit.both$TIMESTAMP, " ", 2)[,2]]

# change the characteristic of date and time
dt.reddit.subset.time$date <- as.Date(dt.reddit.subset.time$date, format = "%Y-%m-%d")
dt.reddit.subset.time$time <- as.Date(dt.reddit.subset.time$time, format = "%H:%M:%S")

# set time filter based on the "date" column
dt.reddit.subset.filter.2015 <- subset(dt.reddit.subset.time, date > "2014-01-01" & date < "2014-02-27")

# run the histogram based on the filtered data table, and change the "time filter" in the "break" parameter
g.posts.hist <- hist(dt.reddit.subset.filter.2015$date, breaks = "day", 
                     xlab = deparse(substitute(dt.reddit.subset.filter.2015$date)),
                     plot = TRUE, freq = FALSE,
                     start.on.monday = TRUE, format)
g.posts.hist

# Show weeks with number of posts
tab <- table(cut(dt.reddit.filter.2015$data, 'week'))
dt.frequency <- data.frame(Date = format(as.Date(names(tab)), '%d/%m/%Y'),
                           Frequency = as.vector(tab))
                           
                           
# Ploting network analysis--------------
#Data frame for graph
g.reddit <- graph.data.frame(dt.reddit.subset.filter.2015[, .(SOURCE_SUBREDDIT, TARGET_SUBREDDIT)],
                             directed = TRUE)
summary(g.reddit)

# Plot network graph base on the "time filter"
V(g.reddit)$title <- "Source and Traget Subbredit Network"
V(g.reddit)$label <- "" 
V(g.reddit)$size <- 50

plot(g.reddit, vertex.size = 3, vertex.label = NA)
